<!DOCTYPE html>
<html>

<head>
    <title>My first html</title>
    <link href="./style.css" rel="stylesheet">
</head>

<body>
    <canvas id="canv"></canvas>
    <script src="scripts.js"></script>
    <script src="time.js"></script>
    <script>
        "use strict"

        let mouseIsDown = false;
        document.addEventListener("mousedown", mouseDown);
        document.addEventListener("mouseup", mouseUp);

        //let spaceBarisPressed = false;
        //document.addEventListener("spacebardown", spacebarDown)
        //document.addEventListener("spacebarup", spacebarUp)
        
        //function spacebarDown() {
           // spaceBarisPressed = true;
        //}

        //function spacebarUp(){
        //    spaceBarisPressed = false;
       // }


        function mouseDown() {
            mouseIsDown = true;
        }

        function mouseUp() {
            mouseIsDown = false;
        }





        let gameWon = true
        let { canvas, ctx } = getCanvas();

        // This part loads the initial rectangle on the screen so places where you want it
        let rectangles = []

        let startX = 100;
        let startY = 400;
        let offsetX = 50;
        let width = 10;
        let height = 50;
        let max = 30;
        let maxWidth = 400;

        //My turn to make somthing cool just a jumping square

        //My first Model
        let rectangles2 = []
        let toAdd2 = {};
        toAdd2.x = 0;
        toAdd2.y = 500;
        toAdd2.w = 50;
        toAdd2.h = 50;
        toAdd2.r = 85;
        toAdd2.g = 255;
        toAdd2.b = 18;
        rectangles2.push(toAdd2)

        // Enter portal always in static postion
        let rectanglesp1 = []
        let portal1 = []
        let toAddp1 = {};
        toAddp1.x = 0;
        toAddp1.y = 300;
        toAddp1.w = 10;
        toAddp1.h = 200;
        toAddp1.r = 48;
        toAddp1.g = 0;
        toAddp1.b = 222;
        rectanglesp1.push(toAddp1)

        //Exit Portal Random postion
        let rectanglesp2 = []
        let portal2 = []
        let toAddp2 = {};
        toAddp2.x = 1525;
        toAddp2.y = 300;
        toAddp2.w = 10;
        toAddp2.h = 200;
        toAddp2.r = 255;
        toAddp2.g = 0;
        toAddp2.b = 0;
        rectanglesp2.push(toAddp2)

        




        //Define the model
        for (let i = 0; i < max; i++) {

            let toAdd = {};
            let percent = i / max;
            let offset = maxWidth * percent;
            let h = (1 - (i / max)) * height

            toAdd.x = startX + offset;
            toAdd.y = startY - 50 - h / 2;
            toAdd.w = width + i * 10;
            toAdd.h = h;

            toAdd.r = 255;
            toAdd.g = percent * 255;
            toAdd.b = 0;

            rectangles.push(toAdd)
        }


        function tick() {
            update()
            draw()
        }

        function update() {
            let i = 0
            for (let rectangle of rectangles) {
                
                rectangle.b = 0;
                if (mouseIsDown)
                    rectangle.b = 255;


                let h = (1 - (i / rectangles.length)) * height

                let percent = i / max;
                let percentSquared = percent * percent;

                rectangle.y = startY - 50 - h / 2 + ease(Time.timePassed) * 50 * percentSquared;

                i++;
            }
            //Let my square move across the screen and jump with clicks
            rectangles2[0].x = rectangles2[0].x + Time.timePassed
            //rectangles2[0].y = rectangles2[0].y + Time.timePassed
            //rectangles2[0].w = rectangles2[0].w + Time.timePassed
            //rectangles2[0].h = rectangles2[0].h + Time.timePassed
            if (mouseIsDown)
            {
                rectangles2[0].y = rectangles2[0].y - 3
            }
            if (!mouseIsDown)
            {
                rectangles2[0].y = rectangles2[0].y + 3
            }
            //Find center of portal2 used for our range

            //Bottom of portal2
            let heightyLocationDifAdd = rectanglesp2[0].y + (rectanglesp2[0].h / 2)
            //Top of portal2
            let heightyLocationDifSub = rectanglesp2[0].y - (rectanglesp2[0].h / 2)

            //Find center of square
            
            //Bottom of square
            let hLDAdd = rectangles2[0].y + (rectangles2[0].h / 2)
            //Top of square
            let hlDSub = rectangles2[0].y - (rectangles2[0].h / 2)


            //Condition that passes if square makes it into the final portal
            if (rectangles2[0].x >= rectanglesp2[0].x && (hlDSub >= heightyLocationDifSub && hLDAdd <= heightyLocationDifAdd ))
            {
                // You win
                // Repostion square to initial spot for level 2
                rectangles2[0].x = 0
                rectangles2[0]. y = 300

                //Randaomize the next exit gate
                rectanglesp2[0].y = Math.floor(Math.random() * 300) + 100


            }
            else if (rectangles2[0].x >= rectanglesp2[0].x)
            {
                //lose
                gameWon = false;

            }
            //else if (!mouseIsDown)
            //{
            //    
            //}
            
        }

        function draw() {

            ctx.fillStyle = "black"
            ctx.strokeStyle = "green"
            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
            let i = 0;
            for (let rectangle of rectangles) {
                let rectangle = rectangles[i];

                ctx.fillStyle = `rgb(${rectangle.r},${rectangle.g},${rectangle.b})`
                ctx.strokeStyle = "white"

                ctx.beginPath()
                ctx.rect(
                    rectangle.x,
                    rectangle.y,
                    rectangle.w,
                    rectangle.h
                )
                ctx.fill();
                ctx.stroke();
                i++;

            }
            //Draw portal 1
            ctx.fillStyle = `rgb(${rectanglesp1[0].r}, ${rectanglesp1[0].g}, ${rectanglesp1[0].b})`
            ctx.strokeStyle = "white"

            ctx.beginPath()
            ctx.rect(
                rectanglesp1[0].x,
                rectanglesp1[0].y,
                rectanglesp1[0].w,
                rectanglesp1[0].h
            )
            ctx.fill();
            ctx.stroke();

            //Draw portal 2
            ctx.fillStyle = `rgb(${rectanglesp2[0].r}, ${rectanglesp2[0].g}, ${rectanglesp2[0].b})`
            ctx.strokeStyle = "white"

            ctx.beginPath()
            ctx.rect(
                rectanglesp2[0].x,
                rectanglesp2[0].y,
                rectanglesp2[0].w,
                rectanglesp2[0].h
            )
            ctx.fill();
            ctx.stroke();

            
            //Draw my static square
            ctx.fillStyle = `rgb(${rectangles2[0].r}, ${rectangles2[0].g}, ${rectangles2[0].b})`
            ctx.strokeStyle = "white"

            ctx.beginPath()
            ctx.rect(
                rectangles2[0].x,
                rectangles2[0].y,
                rectangles2[0].w,
                rectangles2[0].h
            )
            ctx.fill();
            ctx.stroke();

            if (!gameWon)
            {
                ctx.fillStyle = `rgb(${255}, ${0}, ${0})`
                ctx.font = "200px Arial";
                ctx.fillText("YOU LOSE", 175, 400);
                die("Sorry")
            }
            
            Time.timePassed += Time.secondsBetweenFrame;
         }

        setInterval(tick, Time.millisecondsBetweenFrames)

    </script>
</body>

</html>
